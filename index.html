<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content">
  <meta name="theme-color" content="#0f111a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <title>Re-Stocker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <img src="icon-192.png" alt="" width="28" height="28" class="logo">
    <h1>Re-Stocker</h1>
    <label class="switch" title="Simple mode">
      <input id="simple-toggle" type="checkbox"><span>Simple</span>
    </label>
  </header>

  <div id="toast-root"></div>

  <div class="container">
    <!-- Tabs will dock to bottom on phones -->
    <nav class="tabs" aria-label="Navigation">
      <button class="tab active" data-tab="inventory">Inventory</button>
      <button class="tab" data-tab="shopping">Shopping</button>
      <button class="tab" data-tab="add">Add</button>
      <button class="tab" data-tab="summary">Summary</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <!-- INVENTORY -->
    <section id="inventory-view" class="view">
      <div class="quick-add card">
        <input id="qName" inputmode="text" autocomplete="off" placeholder="Add item (e.g., Coffee)">
        <input id="qQty" type="number" step="0.01" inputmode="decimal" placeholder="Qty">
        <select id="qUnit" aria-label="Unit">
          <option value="pcs">pcs</option>
          <option value="g">g</option>
          <option value="ml">ml</option>
          <option value="l">l</option>
        </select>
        <div class="actions qa-actions">
          <button id="qScan" class="ghost" title="Scan barcode">Scan</button>
          <button id="qSave">Add</button>
        </div>
      </div>

      <div class="toolbar">
        <input id="search" class="grow" placeholder="Search items…">
        <button id="export-csv" class="ghost">Export CSV</button>
      </div>

      <div id="inventory-list" class="col"></div>
    </section>

    <!-- SHOPPING -->
    <section id="shopping-view" class="view hidden">
      <div class="card row">
        <div class="col">
          <label>Filter by store</label>
          <select id="store-filter">
            <option value="__ALL__">All stores</option>
          </select>
        </div>
        <div class="col align-end">
          <button id="clear-filter" class="ghost">Clear</button>
          <span id="store-total" class="badge">Estimated: —</span>
        </div>
      </div>

      <div class="actions compact">
        <button id="export-md" class="ghost">Export Names (MD)</button>
        <button id="export-basket-md">Export Basket (MD)</button>
        <button id="export-basket-csv">Export Basket (CSV)</button>
      </div>

      <div class="card" id="best-buys"></div>
      <div id="shop-list"></div>
    </section>

    <!-- ADD / EDIT -->
    <section id="add-view" class="view hidden">
      <form id="form" class="card">
        <input type="hidden" id="itemId">

        <div class="row">
          <div class="col">
            <label>Name</label>
            <input id="name" required placeholder="e.g., Ground Coffee 1kg">
          </div>
          <div class="col">
            <label>Quantity (current stock)</label>
            <input id="quantity" type="number" step="0.01" inputmode="decimal" placeholder="e.g., 1000">
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Unit</label>
            <select id="unit">
              <option value="pcs">pcs</option>
              <option value="g">g</option>
              <option value="ml">ml</option>
              <option value="l">l</option>
            </select>
          </div>
          <div class="col">
            <label>Store (optional)</label>
            <input id="store" list="store-list" placeholder="e.g., Makro">
            <datalist id="store-list"></datalist>
          </div>
        </div>

        <details id="adv" class="adv">
          <summary>More details</summary>
          <div class="row">
            <div class="col">
              <label>Category</label>
              <input id="category" placeholder="e.g., Groceries">
            </div>
            <div class="col">
              <label>Threshold</label>
              <input id="threshold" type="number" step="0.01" inputmode="decimal" placeholder="e.g., 200">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Amount Paid (last)</label>
              <input id="pricePaid" type="number" step="0.01" inputmode="decimal" placeholder="e.g., 89.99">
            </div>
            <div class="col">
              <label>Purchase Time (last)</label>
              <input id="purchaseTs" type="datetime-local">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Barcode</label>
              <div class="actions">
                <input id="barcode" placeholder="e.g., 6009702440308">
                <button type="button" id="scan" class="ghost">Scan</button>
              </div>
            </div>
            <div class="col" style="display:flex;align-items:end;gap:8px">
              <label style="width:100%">
                <input id="notifyBelow" type="checkbox">
                Notify me when below threshold
              </label>
            </div>
          </div>
        </details>

        <div class="card" style="margin-top:12px">
          <h3 style="margin:0 0 8px">Activity</h3>
          <div class="row">
            <div class="col">
              <label>Amount</label>
              <input id="actAmount" type="number" step="0.01" inputmode="decimal" placeholder="e.g., 1">
            </div>
            <div class="col">
              <label>&nbsp;</label>
              <div class="actions">
                <button type="button" id="btnUse">Use now (−)</button>
                <button type="button" id="btnBuy" class="ghost">Purchase (+)</button>
              </div>
            </div>
          </div>
          <div id="actLog" class="kv" style="margin-top:8px"></div>
          <small class="muted">Logs update stock with timestamp. Recent usage estimates days-left.</small>
        </div>

        <div class="actions" style="margin-top:10px">
          <button type="submit">Save</button>
          <button type="reset" class="ghost">Reset</button>
        </div>
      </form>
    </section>

    <!-- SUMMARY -->
    <section id="summary-view" class="view hidden">
      <div class="card" id="summary-cards"></div>
      <div class="card" id="summary-month" style="margin-top:12px"></div>
    </section>

    <!-- SETTINGS -->
    <section id="settings-view" class="view hidden">
      <div class="card">
        <h3>Automation</h3>
        <label class="row switch-row">
          <input id="auto-rate" type="checkbox"> <span>Use 30-day usage to estimate days-left & alerts</span>
        </label>
        <hr>
        <h3>Backup</h3>
        <div class="actions compact">
          <button id="export-json">Export JSON</button>
          <input id="import-file" type="file" accept="application/json" hidden>
          <button id="import-json" class="ghost">Import JSON</button>
          <button id="load-seed" class="ghost">Load Starter Items</button>
        </div>
        <p class="muted">Imports merge by name. Starter set adds common pantry items.</p>
      </div>
    </section>

    <footer><small class="muted">V2.3 — Mobile-friendly</small></footer>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
